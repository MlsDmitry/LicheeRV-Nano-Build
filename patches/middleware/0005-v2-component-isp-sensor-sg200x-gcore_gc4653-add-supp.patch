From 3b5e3948f342d920b5e51801d3cb0da1cf1b8a0d Mon Sep 17 00:00:00 2001
From: Lu Hui <luhui@sipeed.com>
Date: Mon, 19 Feb 2024 19:10:36 +0800
Subject: [PATCH 5/5] v2: component: isp: sensor: sg200x: gcore_gc4653: add
 support for licheervnano

---
 .../sensor/sg200x/gcore_gc4653/gc4653_cmos.c  |  35 +-
 .../sg200x/gcore_gc4653/gc4653_cmos_param.h   |   6 +-
 .../sg200x/gcore_gc4653/gc4653_sensor_ctl.c   | 311 ++++++++----------
 3 files changed, 179 insertions(+), 173 deletions(-)

diff --git a/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_cmos.c b/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_cmos.c
index f21fbb3..85b4c81 100644
--- a/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_cmos.c
+++ b/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_cmos.c
@@ -43,7 +43,8 @@ ISP_SNS_STATE_S *g_pastGc4653[VI_MAX_PIPE_NUM] = {CVI_NULL};
 #define GC4653_SENSOR_RESET_CTX(dev)         (g_pastGc4653[dev] = CVI_NULL)
 
 ISP_SNS_COMMBUS_U g_aunGc4653_BusInfo[VI_MAX_PIPE_NUM] = {
-	[0] = { .s8I2cDev = 3},
+	// for licheervnano
+	[0] = { .s8I2cDev = 4},
 	[1 ... VI_MAX_PIPE_NUM - 1] = { .s8I2cDev = -1}
 };
 
@@ -475,9 +476,35 @@ static CVI_S32 cmos_get_wdr_size(VI_PIPE ViPipe, ISP_SNS_ISP_INFO_S *pstIspCfg)
 
 static CVI_S32 cmos_set_wdr_mode(VI_PIPE ViPipe, CVI_U8 u8Mode)
 {
-	UNUSED(ViPipe);
-	UNUSED(u8Mode);
-	CVI_TRACE_SNS(CVI_DBG_ERR, "Unsupport sensor mode!\n");
+	//UNUSED(ViPipe);
+	//UNUSED(u8Mode);
+
+	ISP_SNS_STATE_S *pstSnsState = CVI_NULL;
+	
+	GC4653_SENSOR_GET_CTX(ViPipe, pstSnsState);
+	CMOS_CHECK_POINTER(pstSnsState);
+
+	pstSnsState->bSyncInit = CVI_FALSE;
+
+	switch (u8Mode) {
+	case WDR_MODE_NONE:
+		pstSnsState->u8ImgMode = GC4653_MODE_2560X1440P30;
+		pstSnsState->enWDRMode = WDR_MODE_NONE;
+		pstSnsState->u32FLStd = g_astGc4653_mode[pstSnsState->u8ImgMode].u32VtsDef;
+		syslog(LOG_INFO, "WDR_MODE_NONE\n");
+		break;
+
+	case WDR_MODE_2To1_LINE:
+	default:
+		CVI_TRACE_SNS(CVI_DBG_ERR, "Unsupport sensor mode!\n");
+		return CVI_FAILURE;
+	}
+
+	pstSnsState->au32FL[0] = pstSnsState->u32FLStd;
+	pstSnsState->au32FL[1] = pstSnsState->au32FL[0];
+	memset(pstSnsState->au32WDRIntTime, 0, sizeof(pstSnsState->au32WDRIntTime));
+
+	//CVI_TRACE_SNS(CVI_DBG_ERR, "Unsupport sensor mode!\n");
 	return CVI_SUCCESS;
 }
 
diff --git a/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_cmos_param.h b/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_cmos_param.h
index 72cab59..e0f8bd3 100644
--- a/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_cmos_param.h
+++ b/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_cmos_param.h
@@ -200,13 +200,13 @@ struct combo_dev_attr_s gc4653_rx_attr = {
 	.mac_clk = RX_MAC_CLK_200M,
 	.mipi_attr = {
 		.raw_data_type = RAW_DATA_10BIT,
-		.lane_id = {2, 1, 3, -1, -1},
-		.pn_swap = {1, 1, 1, 0, 0},
+		.lane_id = {2, 1, 0, -1, -1},
+		.pn_swap = {0, 0, 0, 0, 0},
 		.wdr_mode = CVI_MIPI_WDR_MODE_NONE,
 	},
 	.mclk = {
 		.cam = 0,
-		.freq = CAMPLL_FREQ_27M,
+		.freq = CAMPLL_FREQ_24M,
 	},
 	.devno = 0,
 };
diff --git a/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_sensor_ctl.c b/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_sensor_ctl.c
index 99ab959..4745f3d 100644
--- a/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_sensor_ctl.c
+++ b/v2/component/isp/sensor/sg200x/gcore_gc4653/gc4653_sensor_ctl.c
@@ -23,7 +23,7 @@
 
 static void gc4653_linear_1440p30_init(VI_PIPE ViPipe);
 
-CVI_U8 gc4653_i2c_addr = 0x10;
+CVI_U8 gc4653_i2c_addr = 0x29;
 const CVI_U32 gc4653_addr_byte = 2;
 const CVI_U32 gc4653_data_byte = 1;
 static int g_fd[VI_MAX_PIPE_NUM] = {[0 ... (VI_MAX_PIPE_NUM - 1)] = -1};
@@ -214,172 +214,151 @@ void gc4653_exit(VI_PIPE ViPipe)
 
 static void gc4653_linear_1440p30_init(VI_PIPE ViPipe)
 {
-	delay_ms(10);
-	/****system****/
 	gc4653_write_register(ViPipe, 0x03fe, 0xf0);
-	gc4653_write_register(ViPipe, 0x03fe, 0x00);
-	gc4653_write_register(ViPipe, 0x0317, 0x00);
-	gc4653_write_register(ViPipe, 0x0320, 0x77);
-	gc4653_write_register(ViPipe, 0x0324, 0xc8);
-	gc4653_write_register(ViPipe, 0x0325, 0x06);
-	gc4653_write_register(ViPipe, 0x0326, 0x60);
-	gc4653_write_register(ViPipe, 0x0327, 0x03);
-	gc4653_write_register(ViPipe, 0x0334, 0x40);
-	gc4653_write_register(ViPipe, 0x0336, 0x60);
-	gc4653_write_register(ViPipe, 0x0337, 0x82);
-	gc4653_write_register(ViPipe, 0x0315, 0x25);
-	gc4653_write_register(ViPipe, 0x031c, 0xc6);
-	/****************************************/
-	/*frame structure*/
-	/****************************************/
-	gc4653_write_register(ViPipe, 0x0287, 0x18);
-	gc4653_write_register(ViPipe, 0x0084, 0x00);
-	gc4653_write_register(ViPipe, 0x0087, 0x50);
-	gc4653_write_register(ViPipe, 0x029d, 0x08);
-	gc4653_write_register(ViPipe, 0x0290, 0x00);
-	/**********AHD 30 other need change ******************/
-	gc4653_write_register(ViPipe, 0x0340, 0x05);
-	gc4653_write_register(ViPipe, 0x0341, 0xdc);
-	gc4653_write_register(ViPipe, 0x0345, 0x06);
-	gc4653_write_register(ViPipe, 0x034b, 0xb0);
-	gc4653_write_register(ViPipe, 0x0352, 0x08);
-	gc4653_write_register(ViPipe, 0x0354, 0x08);
-	/****************************************/
-	/*ANALOG CIRCUIT*/
-	/****************************************/
-	gc4653_write_register(ViPipe, 0x02d1, 0xe0);
-	gc4653_write_register(ViPipe, 0x0223, 0xf2);
-	gc4653_write_register(ViPipe, 0x0238, 0xa4);
-	gc4653_write_register(ViPipe, 0x02ce, 0x7f);
-	gc4653_write_register(ViPipe, 0x0232, 0xc4);
-	gc4653_write_register(ViPipe, 0x02d3, 0x05);
-	gc4653_write_register(ViPipe, 0x0243, 0x06);
-	gc4653_write_register(ViPipe, 0x02ee, 0x30);
-	gc4653_write_register(ViPipe, 0x026f, 0x70);
-	gc4653_write_register(ViPipe, 0x0257, 0x09);
-	gc4653_write_register(ViPipe, 0x0211, 0x02);
-	gc4653_write_register(ViPipe, 0x0219, 0x09);
-	gc4653_write_register(ViPipe, 0x023f, 0x2d);
-	gc4653_write_register(ViPipe, 0x0518, 0x00);
-	gc4653_write_register(ViPipe, 0x0519, 0x01);
-	gc4653_write_register(ViPipe, 0x0515, 0x08);
-	gc4653_write_register(ViPipe, 0x02d9, 0x3f);
-	gc4653_write_register(ViPipe, 0x02da, 0x02);
-	gc4653_write_register(ViPipe, 0x02db, 0xe8);
-	gc4653_write_register(ViPipe, 0x02e6, 0x20);
-	gc4653_write_register(ViPipe, 0x021b, 0x10);
-	gc4653_write_register(ViPipe, 0x0252, 0x22);
-	gc4653_write_register(ViPipe, 0x024e, 0x22);
-	gc4653_write_register(ViPipe, 0x02c4, 0x01);
-	gc4653_write_register(ViPipe, 0x021d, 0x17);
-	gc4653_write_register(ViPipe, 0x024a, 0x01);
-	gc4653_write_register(ViPipe, 0x02ca, 0x02);
-	gc4653_write_register(ViPipe, 0x0262, 0x10);
-	gc4653_write_register(ViPipe, 0x029a, 0x20);
-	gc4653_write_register(ViPipe, 0x021c, 0x0e);
-	gc4653_write_register(ViPipe, 0x0298, 0x03);
-	gc4653_write_register(ViPipe, 0x029c, 0x00);
-	gc4653_write_register(ViPipe, 0x027e, 0x14);
-	gc4653_write_register(ViPipe, 0x02c2, 0x10);
-	gc4653_write_register(ViPipe, 0x0540, 0x20);
-	gc4653_write_register(ViPipe, 0x0546, 0x01);
-	gc4653_write_register(ViPipe, 0x0548, 0x01);
-	gc4653_write_register(ViPipe, 0x0544, 0x01);
-	gc4653_write_register(ViPipe, 0x0242, 0x1b);
-	gc4653_write_register(ViPipe, 0x02c0, 0x1b);
-	gc4653_write_register(ViPipe, 0x02c3, 0x20);
-	gc4653_write_register(ViPipe, 0x02e4, 0x10);
-	gc4653_write_register(ViPipe, 0x022e, 0x00);
-	gc4653_write_register(ViPipe, 0x027b, 0x3f);
-	gc4653_write_register(ViPipe, 0x0269, 0x0f);
-	gc4653_write_register(ViPipe, 0x02d2, 0x40);
-	gc4653_write_register(ViPipe, 0x027c, 0x08);
-	gc4653_write_register(ViPipe, 0x023a, 0x2e);
-	gc4653_write_register(ViPipe, 0x0245, 0xce);
-	gc4653_write_register(ViPipe, 0x0530, 0x20);
-	gc4653_write_register(ViPipe, 0x0531, 0x02);
-	gc4653_write_register(ViPipe, 0x0228, 0x50);
-	gc4653_write_register(ViPipe, 0x02ab, 0x00);
-	gc4653_write_register(ViPipe, 0x0250, 0x00);
-	gc4653_write_register(ViPipe, 0x0221, 0x50);
-	gc4653_write_register(ViPipe, 0x02ac, 0x00);
-	gc4653_write_register(ViPipe, 0x02a5, 0x02);
-	gc4653_write_register(ViPipe, 0x0260, 0x0b);
-	gc4653_write_register(ViPipe, 0x0216, 0x04);
-	gc4653_write_register(ViPipe, 0x0299, 0x1C);
-	gc4653_write_register(ViPipe, 0x02bb, 0x0d);
-	gc4653_write_register(ViPipe, 0x02a3, 0x02);
-	gc4653_write_register(ViPipe, 0x02a4, 0x02);
-	gc4653_write_register(ViPipe, 0x021e, 0x02);
-	gc4653_write_register(ViPipe, 0x024f, 0x08);
-	gc4653_write_register(ViPipe, 0x028c, 0x08);
-	gc4653_write_register(ViPipe, 0x0532, 0x3f);
-	gc4653_write_register(ViPipe, 0x0533, 0x02);
-	gc4653_write_register(ViPipe, 0x0277, 0xc0);
-	gc4653_write_register(ViPipe, 0x0276, 0xc0);
-	gc4653_write_register(ViPipe, 0x0239, 0xc0);
-	/*exp*/
-	gc4653_write_register(ViPipe, 0x0202, 0x05);
-	gc4653_write_register(ViPipe, 0x0203, 0x46);
-	/*gain*/
-	gc4653_write_register(ViPipe, 0x0205, 0xc0);
-	gc4653_write_register(ViPipe, 0x02b0, 0x68);
-	/*dpc*/
-	gc4653_write_register(ViPipe, 0x0002, 0xa9);
-	gc4653_write_register(ViPipe, 0x0004, 0x01);
-	/*dark_sun*/
-	gc4653_write_register(ViPipe, 0x021a, 0x98);
-	gc4653_write_register(ViPipe, 0x0266, 0xa0);
-	gc4653_write_register(ViPipe, 0x0020, 0x01);
-	gc4653_write_register(ViPipe, 0x0021, 0x03);
-	gc4653_write_register(ViPipe, 0x0022, 0x00);
-	gc4653_write_register(ViPipe, 0x0023, 0x04);
-	/****************************************/
-	/*mipi*/
-	/****************************************/
-	/***********   AHD 30 ******************/
-	/*30fps*/
-	gc4653_write_register(ViPipe, 0x0342, 0x06);
-	gc4653_write_register(ViPipe, 0x0343, 0x40);
-	/*30fps*/
-	gc4653_write_register(ViPipe, 0x03fe, 0x10);
-	gc4653_write_register(ViPipe, 0x03fe, 0x00);
-	gc4653_write_register(ViPipe, 0x0106, 0x78);
-	gc4653_write_register(ViPipe, 0x0108, 0x0c);
-	gc4653_write_register(ViPipe, 0x0114, 0x01);
-	gc4653_write_register(ViPipe, 0x0115, 0x12);
-	gc4653_write_register(ViPipe, 0x0180, 0x46);
-	gc4653_write_register(ViPipe, 0x0181, 0x30);
-	gc4653_write_register(ViPipe, 0x0182, 0x05);
-	gc4653_write_register(ViPipe, 0x0185, 0x01);
-	gc4653_write_register(ViPipe, 0x03fe, 0x10);
-	gc4653_write_register(ViPipe, 0x03fe, 0x00);
-	gc4653_write_register(ViPipe, 0x0100, 0x09);
-	// 0x008e = 0x00, which means disabling bayer transformation when flip/mirroring
-	//gc4653_write_register(ViPipe, 0x008e, 0x00);
-	//fix FPN
-	gc4653_write_register(ViPipe, 0x0277, 0x38);
-	gc4653_write_register(ViPipe, 0x0276, 0xc0);
-	gc4653_write_register(ViPipe, 0x000f, 0x10);
-	gc4653_write_register(ViPipe, 0x0059, 0x00);//close dither
-	//otp
-	gc4653_write_register(ViPipe, 0x0080, 0x02);
-	gc4653_write_register(ViPipe, 0x0097, 0x0a);
-	gc4653_write_register(ViPipe, 0x0098, 0x10);
-	gc4653_write_register(ViPipe, 0x0099, 0x05);
-	gc4653_write_register(ViPipe, 0x009a, 0xb0);
-	gc4653_write_register(ViPipe, 0x0317, 0x08);
-	gc4653_write_register(ViPipe, 0x0a67, 0x80);
-	gc4653_write_register(ViPipe, 0x0a70, 0x03);
-	gc4653_write_register(ViPipe, 0x0a82, 0x00);
-	gc4653_write_register(ViPipe, 0x0a83, 0x10);
-	gc4653_write_register(ViPipe, 0x0a80, 0x2b);
-	gc4653_write_register(ViPipe, 0x05be, 0x00);
-	gc4653_write_register(ViPipe, 0x05a9, 0x01);
-	gc4653_write_register(ViPipe, 0x0313, 0x80);
-	gc4653_write_register(ViPipe, 0x05be, 0x01);
-	gc4653_write_register(ViPipe, 0x0317, 0x00);
-	gc4653_write_register(ViPipe, 0x0a67, 0x00);
+    gc4653_write_register(ViPipe, 0x03fe, 0x00);
+    gc4653_write_register(ViPipe, 0x0317, 0x00);
+    gc4653_write_register(ViPipe, 0x0320, 0x77);
+    gc4653_write_register(ViPipe, 0x0324, 0xc8);
+    gc4653_write_register(ViPipe, 0x0325, 0x06);
+    gc4653_write_register(ViPipe, 0x0326, 0x6c);
+    gc4653_write_register(ViPipe, 0x0327, 0x03);
+    gc4653_write_register(ViPipe, 0x0334, 0x40);
+    gc4653_write_register(ViPipe, 0x0336, 0x6c);
+    gc4653_write_register(ViPipe, 0x0337, 0x82);
+    gc4653_write_register(ViPipe, 0x0315, 0x25);
+    gc4653_write_register(ViPipe, 0x031c, 0xc6);
+    gc4653_write_register(ViPipe, 0x0287, 0x18);
+    gc4653_write_register(ViPipe, 0x0084, 0x00);
+    gc4653_write_register(ViPipe, 0x0087, 0x50);
+    gc4653_write_register(ViPipe, 0x029d, 0x08);
+    gc4653_write_register(ViPipe, 0x0290, 0x00);
+    gc4653_write_register(ViPipe, 0x0340, 0x05);
+    gc4653_write_register(ViPipe, 0x0341, 0xdc);
+    gc4653_write_register(ViPipe, 0x0345, 0x06);
+    gc4653_write_register(ViPipe, 0x034b, 0xb0);
+
+    gc4653_write_register(ViPipe, 0x0352, 0x06);
+    gc4653_write_register(ViPipe, 0x0354, 0x07);
+    gc4653_write_register(ViPipe, 0x02d1, 0xe0);
+    gc4653_write_register(ViPipe, 0x0223, 0xf2);
+    gc4653_write_register(ViPipe, 0x0238, 0xa4);
+    gc4653_write_register(ViPipe, 0x02ce, 0x7f);
+    gc4653_write_register(ViPipe, 0x0232, 0xc4);
+    gc4653_write_register(ViPipe, 0x02d3, 0x05);
+    gc4653_write_register(ViPipe, 0x0243, 0x06);
+    gc4653_write_register(ViPipe, 0x02ee, 0x30);
+    gc4653_write_register(ViPipe, 0x026f, 0x70);
+    gc4653_write_register(ViPipe, 0x0257, 0x09);
+    gc4653_write_register(ViPipe, 0x0211, 0x02);
+    gc4653_write_register(ViPipe, 0x0219, 0x09);
+    gc4653_write_register(ViPipe, 0x023f, 0x2d);
+    gc4653_write_register(ViPipe, 0x0518, 0x00);
+    gc4653_write_register(ViPipe, 0x0519, 0x1e);
+    gc4653_write_register(ViPipe, 0x0515, 0x30);
+    gc4653_write_register(ViPipe, 0x02d9, 0x5c);
+    gc4653_write_register(ViPipe, 0x02da, 0x02);
+    gc4653_write_register(ViPipe, 0x02db, 0xe8);
+    gc4653_write_register(ViPipe, 0x02e6, 0x20);
+    gc4653_write_register(ViPipe, 0x021b, 0x10);
+    gc4653_write_register(ViPipe, 0x0252, 0x22);
+    gc4653_write_register(ViPipe, 0x024e, 0x22);
+    gc4653_write_register(ViPipe, 0x02c4, 0x01);
+    gc4653_write_register(ViPipe, 0x021d, 0x17);
+    gc4653_write_register(ViPipe, 0x024a, 0x01);
+    gc4653_write_register(ViPipe, 0x02ca, 0x02);
+    gc4653_write_register(ViPipe, 0x0262, 0x10);
+    gc4653_write_register(ViPipe, 0x029a, 0x20);
+    gc4653_write_register(ViPipe, 0x021c, 0x0e);
+    gc4653_write_register(ViPipe, 0x0298, 0x03);
+    gc4653_write_register(ViPipe, 0x029c, 0x00);
+    gc4653_write_register(ViPipe, 0x027e, 0x14);
+    gc4653_write_register(ViPipe, 0x02c2, 0x10);
+    gc4653_write_register(ViPipe, 0x0540, 0x20);
+    gc4653_write_register(ViPipe, 0x0546, 0x01);
+    gc4653_write_register(ViPipe, 0x0548, 0x01);
+    gc4653_write_register(ViPipe, 0x0544, 0x01);
+    gc4653_write_register(ViPipe, 0x0242, 0x1b);
+    gc4653_write_register(ViPipe, 0x02c0, 0x1b);
+    gc4653_write_register(ViPipe, 0x02c3, 0x20);
+    gc4653_write_register(ViPipe, 0x02e4, 0x10);
+    gc4653_write_register(ViPipe, 0x022e, 0x00);
+    gc4653_write_register(ViPipe, 0x027b, 0x3f);
+    gc4653_write_register(ViPipe, 0x0269, 0x0f);
+    gc4653_write_register(ViPipe, 0x02d2, 0x40);
+    gc4653_write_register(ViPipe, 0x027c, 0x08);
+    gc4653_write_register(ViPipe, 0x023a, 0x2e);
+    gc4653_write_register(ViPipe, 0x0245, 0xce);
+    gc4653_write_register(ViPipe, 0x0530, 0x20);
+    gc4653_write_register(ViPipe, 0x0531, 0x02);
+    gc4653_write_register(ViPipe, 0x0228, 0x50);
+    gc4653_write_register(ViPipe, 0x02ab, 0x00);
+    gc4653_write_register(ViPipe, 0x0250, 0x00);
+    gc4653_write_register(ViPipe, 0x0221, 0x50);
+    gc4653_write_register(ViPipe, 0x02ac, 0x00);
+    gc4653_write_register(ViPipe, 0x02a5, 0x02);
+    gc4653_write_register(ViPipe, 0x0260, 0x0b);
+    gc4653_write_register(ViPipe, 0x0216, 0x04);
+    gc4653_write_register(ViPipe, 0x0299, 0x1C);
+    gc4653_write_register(ViPipe, 0x02bb, 0x0d);
+    gc4653_write_register(ViPipe, 0x02a3, 0x02);
+    gc4653_write_register(ViPipe, 0x02a4, 0x02);
+    gc4653_write_register(ViPipe, 0x021e, 0x02);
+    gc4653_write_register(ViPipe, 0x024f, 0x08);
+    gc4653_write_register(ViPipe, 0x028c, 0x08);
+    gc4653_write_register(ViPipe, 0x0532, 0x3f);
+    gc4653_write_register(ViPipe, 0x0533, 0x02);
+    gc4653_write_register(ViPipe, 0x0277, 0xc0);
+    gc4653_write_register(ViPipe, 0x0276, 0xc0);
+    gc4653_write_register(ViPipe, 0x0239, 0xc0);
+    gc4653_write_register(ViPipe, 0x0202, 0x05);
+    gc4653_write_register(ViPipe, 0x0203, 0xd0);
+    gc4653_write_register(ViPipe, 0x0205, 0xc0);
+    gc4653_write_register(ViPipe, 0x02b0, 0x68);
+    gc4653_write_register(ViPipe, 0x0002, 0xa9);
+    gc4653_write_register(ViPipe, 0x0004, 0x01);
+    gc4653_write_register(ViPipe, 0x021a, 0x98);
+    gc4653_write_register(ViPipe, 0x0266, 0xa0);
+    gc4653_write_register(ViPipe, 0x0020, 0x01);
+    gc4653_write_register(ViPipe, 0x0021, 0x03);
+    gc4653_write_register(ViPipe, 0x0022, 0x00);
+    gc4653_write_register(ViPipe, 0x0023, 0x04);
+
+    gc4653_write_register(ViPipe, 0x0342, 0x06);
+    gc4653_write_register(ViPipe, 0x0343, 0x40);
+    gc4653_write_register(ViPipe, 0x03fe, 0x10);
+    gc4653_write_register(ViPipe, 0x03fe, 0x00);
+    gc4653_write_register(ViPipe, 0x0106, 0x78);
+    gc4653_write_register(ViPipe, 0x0108, 0x0c);
+    gc4653_write_register(ViPipe, 0x0114, 0x01);
+    gc4653_write_register(ViPipe, 0x0115, 0x10); //0x12 coninute mode, 0x10 no-continue mode
+    gc4653_write_register(ViPipe, 0x0180, 0x46);
+    gc4653_write_register(ViPipe, 0x0181, 0x30);
+    gc4653_write_register(ViPipe, 0x0182, 0x05);
+    gc4653_write_register(ViPipe, 0x0185, 0x01);
+    gc4653_write_register(ViPipe, 0x03fe, 0x10);
+    gc4653_write_register(ViPipe, 0x03fe, 0x00);
+    gc4653_write_register(ViPipe, 0x000f, 0x00);
+    gc4653_write_register(ViPipe, 0x0100, 0x09); //stream on
+    //otp
+    gc4653_write_register(ViPipe, 0x0080, 0x02);
+    gc4653_write_register(ViPipe, 0x0097, 0x0a);
+    gc4653_write_register(ViPipe, 0x0098, 0x10);
+    gc4653_write_register(ViPipe, 0x0099, 0x05);
+    gc4653_write_register(ViPipe, 0x009a, 0xb0);
+    gc4653_write_register(ViPipe, 0x0317, 0x08);
+    gc4653_write_register(ViPipe, 0x0a67, 0x80);
+    gc4653_write_register(ViPipe, 0x0a70, 0x03);
+    gc4653_write_register(ViPipe, 0x0a82, 0x00);
+    gc4653_write_register(ViPipe, 0x0a83, 0x10);
+    gc4653_write_register(ViPipe, 0x0a80, 0x2b);
+    gc4653_write_register(ViPipe, 0x05be, 0x00);
+    gc4653_write_register(ViPipe, 0x05a9, 0x01);
+    gc4653_write_register(ViPipe, 0x0313, 0x80);
+    gc4653_write_register(ViPipe, 0x05be, 0x01);
+    gc4653_write_register(ViPipe, 0x0317, 0x00);
+    gc4653_write_register(ViPipe, 0x0a67, 0x00);
+
+    gc4653_write_register(ViPipe, 0x0000, 0x00);  // end flag
 
 	gc4653_default_reg_init(ViPipe);
 	delay_ms(10);
-- 
2.40.1

